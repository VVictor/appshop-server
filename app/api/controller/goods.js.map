{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\api\\controller\\goods.js"
    ],
    "names": [
        "Base",
        "require",
        "moment",
        "module",
        "exports",
        "indexAction",
        "model",
        "goodsList",
        "select",
        "success",
        "saveUserIdAction",
        "formId",
        "post",
        "user",
        "where",
        "id",
        "think",
        "userId",
        "find",
        "currentTime",
        "parseInt",
        "Date",
        "getTime",
        "data",
        "form_id",
        "order_id",
        "user_id",
        "add_time",
        "add",
        "detailAction",
        "goodsId",
        "get",
        "info",
        "gallery",
        "goods_id",
        "is_delete",
        "order",
        "limit",
        "addFootprint",
        "productList",
        "getProductList",
        "goodsNumber",
        "item",
        "goods_number",
        "specificationList",
        "getSpecificationList",
        "goodsShareAction",
        "field",
        "listAction",
        "keyword",
        "sort",
        "sales",
        "whereMap",
        "is_on_sale",
        "isEmpty",
        "name",
        "orderMap",
        "retail_price",
        "sell_volume",
        "sort_order",
        "goodsData",
        "countAction",
        "goodsCount",
        "count"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\api\\controller\\goods.js",
    "sourcesContent": [
        "const Base = require('./base.js');\nconst moment = require('moment');\nmodule.exports = class extends Base {\n    async indexAction() {\n        const model = this.model('goods');\n        const goodsList = await model.select();\n        return this.success(goodsList);\n    }\n    /**\n     * 获取sku信息，用于购物车编辑时选择规格\n     * @returns {Promise.<Promise|PreventPromise|void>}\n     */\n    async saveUserIdAction() {\n        const formId = this.post('formId');\n        let user = await this.model('user').where({\n            id: think.userId\n        }).find();\n        const currentTime = parseInt(new Date().getTime() / 1000);\n        let data = {\n            form_id: formId,\n            order_id: 0,\n            user_id: think.userId,\n            add_time: currentTime,\n        }\n        await this.model('formid').add(data);\n    }\n    /**\n     * 商品详情页数据\n     * @returns {Promise.<Promise|PreventPromise|void>}\n     */\n    async detailAction() {\n        const goodsId = this.get('id');\n        const model = this.model('goods');\n        const info = await model.where({\n            'id': goodsId\n        }).find();\n        const gallery = await this.model('goods_gallery').where({\n            goods_id: goodsId,\n            is_delete: 0,\n        }).order('sort_order').limit(6).select();\n        await this.model('footprint').addFootprint(think.userId, goodsId);\n        let productList = await model.getProductList(goodsId);\n        let goodsNumber = 0;\n        for (const item of productList) {\n            if (item.goods_number > 0) {\n                goodsNumber = goodsNumber + item.goods_number;\n            }\n        }\n        info.goods_number = goodsNumber;\n        return this.success({\n            info: info,\n            gallery: gallery,\n            specificationList: await model.getSpecificationList(goodsId),\n            productList: await model.getProductList(goodsId),\n        });\n    }\n    async goodsShareAction() {\n        const goodsId = this.get('id');\n        const info = await this.model('goods').where({\n            id: goodsId\n        }).field('name,retail_price').find();\n        return this.success(info);\n    }\n    /**\n     * 获取商品列表\n     * @returns {Promise.<*>}\n     */\n    async listAction() {\n        const keyword = this.get('keyword');\n        const sort = this.get('sort');\n        const order = this.get('order');\n        const sales = this.get('sales');\n        const model = this.model('goods');\n        const whereMap = {\n            is_on_sale: 1,\n            is_delete: 0,\n        };\n        if (!think.isEmpty(keyword)) {\n            whereMap.name = ['like', `%${keyword}%`];\n            // 添加到搜索历史\n            await this.model('search_history').add({\n                keyword: keyword,\n                user_id: think.userId,\n                add_time: parseInt(new Date().getTime() / 1000)\n            });\n            //    TODO 之后要做个判断，这个词在搜索记录中的次数，如果大于某个值，则将他存入keyword\n        }\n        // 排序\n        let orderMap = {};\n        if (sort === 'price') {\n            // 按价格\n            orderMap = {\n                retail_price: order\n            };\n        } else if (sort === 'sales') {\n            // 按价格\n            orderMap = {\n                sell_volume: sales\n            };\n        } else {\n            // 按商品添加时间\n            orderMap = {\n                sort_order: 'asc'\n            };\n        }\n        const goodsData = await model.where(whereMap).order(orderMap).select();\n        return this.success(goodsData);\n    }\n    /**\n     * 在售的商品总数\n     * @returns {Promise.<Promise|PreventPromise|void>}\n     */\n    async countAction() {\n        const goodsCount = await this.model('goods').where({\n            is_delete: 0,\n            is_on_sale: 1\n        }).count('id');\n        return this.success({\n            goodsCount: goodsCount\n        });\n    }\n};"
    ]
}